<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾®ä¿¡å¿«æ·å›å¤å·¥å…· - å¾®ä¿¡å¤šæµè§ˆå™¨åŒæ­¥</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        body {
            background: #f5f5f5;
            color: #333;
            min-height: 100vh;
            padding: 10px;
            font-size: 14px;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding-bottom: 70px;
        }
        
        header {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 18px;
            margin-bottom: 8px;
            color: #07C160;
            text-align: center;
        }
        
        .subtitle {
            font-size: 12px;
            color: #999;
            text-align: center;
        }
        
        .wechat-tips {
            background: #E8F4FD;
            border: 1px solid #BBDEFB;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #1976D2;
        }
        
        .sync-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 8px 12px;
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 12px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 5px;
            display: none;
        }
        
        .sync-status.syncing {
            color: #10AEFF;
        }
        
        .sync-status.success {
            color: #07C160;
        }
        
        .sync-status.error {
            color: #FF6B35;
        }
        
        .storage-options {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .storage-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .storage-option:last-child {
            border-bottom: none;
        }
        
        .storage-info {
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
        
        .search-container {
            position: sticky;
            top: 0;
            z-index: 90;
            background: #f5f5f5;
            padding: 10px 0;
            margin-bottom: 15px;
        }
        
        .search-box {
            background: white;
            padding: 12px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .search-box input {
            width: 100%;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            outline: none;
        }
        
        .search-box input:focus {
            border-color: #07C160;
        }
        
        .folders-container {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 15px;
            -webkit-overflow-scrolling: touch;
        }
        
        .folder {
            background: white;
            border-radius: 8px;
            padding: 12px 15px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            min-width: 120px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .folder.active {
            border-color: #07C160;
            background: #f0fff0;
        }
        
        .folder-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .folder-count {
            font-size: 12px;
            color: #999;
        }
        
        .folder-actions {
            margin-top: 8px;
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .folder-action-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            padding: 4px 6px;
            font-size: 10px;
            color: #666;
            cursor: pointer;
        }
        
        .folder-action-btn.edit {
            background: #10AEFF;
            color: white;
        }
        
        .folder-action-btn.delete {
            background: #FF6B35;
            color: white;
        }
        
        .add-folder-btn {
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            padding: 12px 15px;
            min-width: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #999;
            cursor: pointer;
        }
        
        .text-blocks-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .text-block {
            background: white;
            border-radius: 8px;
            padding: 0;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            overflow: visible;
            position: relative;
        }
        
        .text-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            position: relative;
        }
        
        .text-block-title {
            font-size: 15px;
            font-weight: 500;
            color: #333;
            flex: 1;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .collapse-icon {
            font-size: 12px;
            color: #999;
            transition: transform 0.3s ease;
        }
        
        .text-block.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }
        
        .text-block-actions {
            display: flex;
            gap: 6px;
            align-items: center;
            position: relative;
        }
        
        .action-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: #f8f8f8;
            border: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .action-icon:hover {
            background: #f0f0f0;
        }
        
        .action-icon.copy {
            color: #07C160;
        }
        
        .action-icon.edit {
            color: #10AEFF;
        }
        
        .action-icon.more {
            color: #666;
        }
        
        .text-block-content {
            padding: 15px;
            background: #fafafa;
            font-size: 14px;
            line-height: 1.5;
            color: #666;
        }
        
        .text-block.collapsed .text-block-content {
            display: none;
        }
        
        .text-block-footer {
            padding: 10px 15px;
            background: #f8f8f8;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        
        .text-block.collapsed .text-block-footer {
            display: none;
        }
        
        .copy-content-btn, .share-image-btn {
            background: #07C160;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 13px;
            cursor: pointer;
        }
        
        .share-image-btn {
            background: #FF6B35;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #999;
            font-weight: normal;
        }
        
        .empty-state p {
            color: #ccc;
            margin-bottom: 20px;
            font-size: 12px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 100%;
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal h2 {
            margin-bottom: 15px;
            font-size: 16px;
            text-align: center;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #666;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            font-size: 14px;
            resize: none;
        }
        
        .copy-success {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1001;
            font-size: 14px;
            display: none;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 6px;
            margin-top: 10px;
            display: block;
        }
        
        .image-upload-area {
            border: 2px dashed #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .image-upload-area:hover {
            border-color: #07C160;
            background: #f8fff8;
        }
        
        .upload-icon {
            font-size: 24px;
            margin-bottom: 8px;
            color: #999;
        }
        
        .image-block-indicator {
            background: #FF6B35;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            margin-left: 8px;
        }
        
        .share-modal-content {
            text-align: center;
            padding: 20px;
        }
        
        .share-image-preview {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .share-steps {
            text-align: left;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 13px;
        }
        
        .share-steps ol {
            margin: 0;
            padding-left: 20px;
        }
        
        .share-steps li {
            margin-bottom: 8px;
        }
        
        .floating-toolbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            z-index: 100;
        }
        
        .floating-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: none;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            color: #666;
            cursor: pointer;
        }
        
        .floating-btn.primary {
            color: #07C160;
        }
        
        .floating-btn.image {
            color: #FF6B35;
        }
        
        .floating-btn.secondary {
            color: #10AEFF;
        }
        
        .floating-btn-icon {
            font-size: 20px;
            margin-bottom: 4px;
        }
        
        .more-actions {
            position: relative;
        }
        
        .more-menu {
            display: none;
            position: fixed;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 8px;
            z-index: 1002;
            min-width: 140px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .more-menu button {
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: none;
            text-align: left;
            border-radius: 4px;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .more-menu button:hover {
            background: #f5f5f5;
        }
        
        .menu-icon {
            font-size: 14px;
            width: 16px;
            text-align: center;
        }
        
        .export-textarea {
            width: 100%;
            height: 200px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            font-size: 12px;
            font-family: monospace;
            resize: none;
            margin-bottom: 10px;
        }
        
        .import-textarea {
            width: 100%;
            height: 150px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 10px;
            font-size: 12px;
            font-family: monospace;
            resize: none;
            margin-bottom: 10px;
        }
        
        /* ç§»é™¤ç§»åŠ¨æŒ‰é’®æ ·å¼ */
        .move-buttons {
            display: none;
        }

        .wechat-sync-tips {
            background: #f0f8ff;
            border: 1px solid #d1e7ff;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 15px;
            font-size: 12px;
            color: #1890ff;
        }
    </style>
</head>
<body>
    <div class="sync-status" id="syncStatus">
        <span class="sync-icon">ğŸ”„</span>
        <span class="sync-text">åŒæ­¥ä¸­...</span>
    </div>

    <div class="container">
        <header>
            <h1>å¾®ä¿¡å¿«æ·å›å¤ - å¾®ä¿¡å¤šæµè§ˆå™¨åŒæ­¥</h1>
            <p class="subtitle">åŸºäºå¾®ä¿¡çš„æ•°æ®åŒæ­¥æ–¹æ¡ˆ</p>
        </header>
        
        <div class="wechat-tips">
            ğŸ’¡ ä½¿ç”¨æç¤ºï¼šæ–‡å­—å†…å®¹å¯ç›´æ¥å¤åˆ¶ï¼Œå›¾ç‰‡å†…å®¹è¯·ä½¿ç”¨"è½¬å‘å›¾ç‰‡"åŠŸèƒ½
        </div>

        <div class="wechat-sync-tips">
            ğŸ’¡ å¾®ä¿¡åŒæ­¥æ–¹æ¡ˆï¼šé€šè¿‡å¾®ä¿¡æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹å®ç°å¤šè®¾å¤‡æ•°æ®åŒæ­¥
        </div>

        <!-- å­˜å‚¨é€‰é¡¹ -->
        <div class="storage-options">
            <div class="storage-option">
                <div>
                    <strong>å¾®ä¿¡æ•°æ®åŒæ­¥æ–¹æ¡ˆ</strong>
                    <div class="storage-info">é€šè¿‡å¾®ä¿¡æ–‡ä»¶ä¼ è¾“å®ç°å¤šè®¾å¤‡åŒæ­¥</div>
                </div>
                <button id="setupSyncBtn" style="background: #07C160; color: white; padding: 8px 12px; border: none; border-radius: 6px; font-size: 12px;">åŒæ­¥è®¾ç½®</button>
            </div>
        </div>
        
        <!-- æ–‡ä»¶å¤¹å¯¼èˆª -->
        <div class="folders-container" id="foldersContainer">
            <div class="folder active" data-folder="all">
                <div class="folder-name">å…¨éƒ¨</div>
                <div class="folder-count" id="allCount">0</div>
            </div>
            <!-- æ–‡ä»¶å¤¹å°†åŠ¨æ€æ·»åŠ åˆ°è¿™é‡Œ -->
            <div class="add-folder-btn" id="addFolderBtn">
                <div>+</div>
                <div>æ–°å»ºæ–‡ä»¶å¤¹</div>
            </div>
        </div>
        
        <!-- å›ºå®šæœç´¢æ  -->
        <div class="search-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœç´¢è¯æœ¯æ ‡é¢˜...">
            </div>
        </div>
        
        <div class="text-blocks-container" id="blocksContainer">
            <div class="empty-state">
                <h3>è¿˜æ²¡æœ‰å¿«æ·å›å¤å†…å®¹</h3>
                <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ›å»º</p>
            </div>
        </div>
    </div>
    
    <!-- åº•éƒ¨å›ºå®šå·¥å…·æ  -->
    <div class="floating-toolbar">
        <button class="floating-btn primary" id="floatingAddBlockBtn">
            <span class="floating-btn-icon">+</span>
            <span>æ–°å»ºè¯æœ¯</span>
        </button>
        <button class="floating-btn image" id="floatingAddImageBtn">
            <span class="floating-btn-icon">ğŸ–¼ï¸</span>
            <span>æ·»åŠ å›¾ç‰‡</span>
        </button>
        <button class="floating-btn" id="floatingImportBtn">
            <span class="floating-btn-icon">ğŸ“¥</span>
            <span>å¯¼å…¥</span>
        </button>
        <button class="floating-btn secondary" id="floatingExportBtn">
            <span class="floating-btn-icon">ğŸ“¤</span>
            <span>å¯¼å‡º</span>
        </button>
    </div>
    
    <!-- æ·»åŠ /ç¼–è¾‘æ–‡æœ¬å—çš„æ¨¡æ€æ¡† -->
    <div class="modal" id="blockModal">
        <div class="modal-content">
            <h2 id="modalTitle">æ–°å»ºè¯æœ¯</h2>
            <div class="form-group">
                <label for="blockTitle">è¯æœ¯æ ‡é¢˜</label>
                <input type="text" id="blockTitle" placeholder="ä¾‹å¦‚ï¼šæ¬¢è¿è¯­ã€äº§å“ä»‹ç»...">
            </div>
            <div class="form-group">
                <label for="blockContent">å›å¤å†…å®¹</label>
                <textarea id="blockContent" placeholder="è¯·è¾“å…¥å›å¤å†…å®¹..." rows="4"></textarea>
            </div>
            <div class="form-group">
                <label for="blockFolder">é€‰æ‹©æ–‡ä»¶å¤¹</label>
                <select id="blockFolder">
                    <option value="default">é»˜è®¤æ–‡ä»¶å¤¹</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="cancelBtn" style="background: #f0f0f0;">å–æ¶ˆ</button>
                <button id="saveBtn" style="background: #07C160; color: white;">ä¿å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ å›¾ç‰‡çš„æ¨¡æ€æ¡† -->
    <div class="modal" id="imageModal">
        <div class="modal-content">
            <h2>æ·»åŠ å›¾ç‰‡</h2>
            <div class="form-group">
                <label for="imageTitle">å›¾ç‰‡æ ‡é¢˜</label>
                <input type="text" id="imageTitle" placeholder="ä¾‹å¦‚ï¼šäº§å“å›¾ç‰‡ã€äºŒç»´ç ...">
            </div>
            <div class="form-group">
                <label>ä¸Šä¼ å›¾ç‰‡</label>
                <div class="image-upload-area" id="imageUploadArea">
                    <div class="upload-icon">ğŸ“</div>
                    <div>ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½åˆ°æ­¤å¤„</div>
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">æ”¯æŒ JPGã€PNG æ ¼å¼</div>
                </div>
                <input type="file" id="imageFile" accept="image/*" style="display: none;">
                <div id="imagePreviewContainer" style="display: none;">
                    <img id="imagePreview" class="image-preview" alt="å›¾ç‰‡é¢„è§ˆ">
                </div>
            </div>
            <div class="form-group">
                <label for="imageFolder">é€‰æ‹©æ–‡ä»¶å¤¹</label>
                <select id="imageFolder">
                    <option value="default">é»˜è®¤æ–‡ä»¶å¤¹</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="cancelImageBtn" style="background: #f0f0f0;">å–æ¶ˆ</button>
                <button id="saveImageBtn" style="background: #FF6B35; color: white;">ä¿å­˜å›¾ç‰‡</button>
            </div>
        </div>
    </div>
    
    <!-- å›¾ç‰‡åˆ†äº«æ¨¡æ€æ¡† -->
    <div class="modal" id="shareModal">
        <div class="modal-content share-modal-content">
            <h2>è½¬å‘å›¾ç‰‡</h2>
            <img id="shareImagePreview" class="share-image-preview" alt="åˆ†äº«å›¾ç‰‡">
            <div class="share-steps">
                <strong>è½¬å‘æ­¥éª¤ï¼š</strong>
                <ol>
                    <li>é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡</li>
                    <li>é€‰æ‹©"è½¬å‘ç»™æœ‹å‹"</li>
                    <li>æˆ–é€‰æ‹©"ä¿å­˜åˆ°æ‰‹æœº"</li>
                </ol>
            </div>
            <div class="modal-buttons">
                <button id="closeShareBtn" style="background: #f0f0f0; flex: 1;">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- å¯¼å‡ºé€‰é¡¹æ¨¡æ€æ¡† -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <h2>å¯¼å‡ºå†…å®¹</h2>
            <div class="form-group">
                <label>å¯¼å‡ºæ•°æ® (å¤åˆ¶æ­¤å†…å®¹ä¿å­˜åˆ°å…¶ä»–åœ°æ–¹)</label>
                <textarea class="export-textarea" id="exportData" readonly></textarea>
            </div>
            <div class="modal-buttons">
                <button id="copyExportBtn" style="background: #07C160; color: white;">å¤åˆ¶æ•°æ®</button>
                <button id="closeExportBtn" style="background: #f0f0f0;">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- å¯¼å…¥æ¨¡æ€æ¡† -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <h2>å¯¼å…¥å†…å®¹</h2>
            <div class="form-group">
                <label>ç²˜è´´ä¹‹å‰å¯¼å‡ºçš„æ•°æ®</label>
                <textarea class="import-textarea" id="importData" placeholder="è¯·ç²˜è´´ä¹‹å‰å¯¼å‡ºçš„æ•°æ®..."></textarea>
            </div>
            <div class="modal-buttons">
                <button id="confirmImportBtn" style="background: #07C160; color: white;">ç¡®è®¤å¯¼å…¥</button>
                <button id="closeImportBtn" style="background: #f0f0f0;">å–æ¶ˆ</button>
            </div>
        </div>
    </div>
    
    <!-- æ–‡ä»¶å¤¹ç®¡ç†æ¨¡æ€æ¡† -->
    <div class="modal" id="folderModal">
        <div class="modal-content">
            <h2 id="folderModalTitle">æ–°å»ºæ–‡ä»¶å¤¹</h2>
            <div class="form-group">
                <label for="folderName">æ–‡ä»¶å¤¹åç§°</label>
                <input type="text" id="folderName" placeholder="ä¾‹å¦‚ï¼šæ–°å®¢æˆ·ã€è€å®¢æˆ·...">
            </div>
            <div class="modal-buttons">
                <button id="cancelFolderBtn" style="background: #f0f0f0;">å–æ¶ˆ</button>
                <button id="saveFolderBtn" style="background: #10AEFF; color: white;">ä¿å­˜</button>
            </div>
        </div>
    </div>
    
    <!-- ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹æ¨¡æ€æ¡† -->
    <div class="modal" id="moveToFolderModal">
        <div class="modal-content">
            <h2>ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹</h2>
            <div class="form-group">
                <label for="targetFolder">é€‰æ‹©ç›®æ ‡æ–‡ä»¶å¤¹</label>
                <select id="targetFolder">
                    <option value="default">é»˜è®¤æ–‡ä»¶å¤¹</option>
                </select>
            </div>
            <div class="modal-buttons">
                <button id="cancelMoveBtn" style="background: #f0f0f0;">å–æ¶ˆ</button>
                <button id="confirmMoveBtn" style="background: #07C160; color: white;">ç¡®è®¤ç§»åŠ¨</button>
            </div>
        </div>
    </div>
    
    <!-- å¾®ä¿¡åŒæ­¥è®¾ç½®æ¨¡æ€æ¡† -->
    <div class="modal" id="syncModal">
        <div class="modal-content">
            <h2>å¾®ä¿¡æ•°æ®åŒæ­¥æ–¹æ¡ˆ</h2>
            
            <div class="wechat-sync-tips">
                <strong>åŒæ­¥åŸç†ï¼š</strong><br>
                1. å¯¼å‡ºæ•°æ®æ–‡ä»¶å‘é€åˆ°"æ–‡ä»¶ä¼ è¾“åŠ©æ‰‹"<br>
                2. åœ¨å…¶ä»–è®¾å¤‡æ‰“å¼€æ–‡ä»¶å¹¶å¯¼å…¥<br>
                3. å®ç°å¤šè®¾å¤‡æ•°æ®åŒæ­¥
            </div>

            <div class="form-group">
                <label>è‡ªåŠ¨å¤‡ä»½åˆ°å¾®ä¿¡</label>
                <div style="display: flex; gap: 10px;">
                    <button id="autoBackupBtn" style="flex: 1; padding: 12px; background: #07C160; color: white; border: none; border-radius: 6px; cursor: pointer;">å¼€å¯è‡ªåŠ¨å¤‡ä»½</button>
                    <button id="manualBackupBtn" style="flex: 1; padding: 12px; background: #10AEFF; color: white; border: none; border-radius: 6px; cursor: pointer;">æ‰‹åŠ¨å¤‡ä»½</button>
                </div>
            </div>

            <div class="form-group">
                <label>ä»å¾®ä¿¡æ¢å¤</label>
                <div style="display: flex; gap: 10px;">
                    <button id="restoreBackupBtn" style="flex: 1; padding: 12px; background: #FF6B35; color: white; border: none; border-radius: 6px; cursor: pointer;">ä»å¤‡ä»½æ¢å¤</button>
                </div>
            </div>

            <div class="form-group">
                <label>åŒæ­¥çŠ¶æ€</label>
                <div id="syncStatusInfo" style="padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 12px;">
                    æœªå¼€å¯è‡ªåŠ¨å¤‡ä»½
                </div>
            </div>

            <div class="modal-buttons">
                <button id="closeSyncBtn" style="background: #f0f0f0;">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <div class="copy-success" id="copySuccess">âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

<script>
    // å­˜å‚¨æ•°æ®
    let textBlocks = JSON.parse(localStorage.getItem('wechatQuickReplies')) || [];
    let folders = JSON.parse(localStorage.getItem('wechatFolders')) || [{id: 'default', name: 'é»˜è®¤æ–‡ä»¶å¤¹'}];
    let editingIndex = -1;
    let currentImageData = null;
    let movingBlockIndex = -1;
    let editingFolderId = null;
    
    // åŒæ­¥ç›¸å…³å˜é‡
    let autoBackupEnabled = localStorage.getItem('autoBackupEnabled') === 'true';
    const BACKUP_FILE_NAME = 'å¾®ä¿¡å¿«æ·å›å¤å¤‡ä»½.json';
    
    // DOMå…ƒç´ 
    const blocksContainer = document.getElementById('blocksContainer');
    const searchInput = document.getElementById('searchInput');
    const foldersContainer = document.getElementById('foldersContainer');
    const syncStatus = document.getElementById('syncStatus');
    const setupSyncBtn = document.getElementById('setupSyncBtn');
    
    // åˆå§‹åŒ–
    async function init() {
        renderFolders();
        renderBlocks();
        setupEventListeners();
        updateFolderSelects();
        
        // æ›´æ–°åŒæ­¥çŠ¶æ€æ˜¾ç¤º
        updateSyncStatusDisplay();
        
        // å¦‚æœå¼€å¯äº†è‡ªåŠ¨å¤‡ä»½ï¼Œæ£€æŸ¥æ˜¯å¦éœ€è¦å¤‡ä»½
        if (autoBackupEnabled) {
            checkAutoBackup();
        }
    }
    
    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
        // åŒæ­¥ç›¸å…³äº‹ä»¶
        setupSyncBtn.addEventListener('click', openSyncModal);
        
        // åº•éƒ¨å›ºå®šå·¥å…·æ äº‹ä»¶
        document.getElementById('floatingAddBlockBtn').addEventListener('click', () => openModal());
        document.getElementById('floatingAddImageBtn').addEventListener('click', () => openImageModal());
        document.getElementById('floatingImportBtn').addEventListener('click', openImportModal);
        document.getElementById('floatingExportBtn').addEventListener('click', openExportModal);
        
        // æ¨¡æ€æ¡†æŒ‰é’®äº‹ä»¶
        document.getElementById('saveBtn').addEventListener('click', saveBlock);
        document.getElementById('saveImageBtn').addEventListener('click', saveImage);
        document.getElementById('cancelBtn').addEventListener('click', closeModal);
        document.getElementById('cancelImageBtn').addEventListener('click', closeImageModal);
        document.getElementById('closeShareBtn').addEventListener('click', closeShareModal);
        document.getElementById('saveFolderBtn').addEventListener('click', saveFolder);
        document.getElementById('cancelFolderBtn').addEventListener('click', closeFolderModal);
        document.getElementById('confirmMoveBtn').addEventListener('click', confirmMoveToFolder);
        document.getElementById('cancelMoveBtn').addEventListener('click', closeMoveToFolderModal);
        document.getElementById('confirmImportBtn').addEventListener('click', confirmImport);
        document.getElementById('closeImportBtn').addEventListener('click', closeImportModal);
        document.getElementById('copyExportBtn').addEventListener('click', copyExportData);
        document.getElementById('closeExportBtn').addEventListener('click', closeExportModal);
        
        // åŒæ­¥æ¨¡æ€æ¡†äº‹ä»¶
        document.getElementById('autoBackupBtn').addEventListener('click', toggleAutoBackup);
        document.getElementById('manualBackupBtn').addEventListener('click', createManualBackup);
        document.getElementById('restoreBackupBtn').addEventListener('click', restoreFromBackup);
        document.getElementById('closeSyncBtn').addEventListener('click', closeSyncModal);
        
        // æœç´¢äº‹ä»¶
        searchInput.addEventListener('input', renderBlocks);
        
        // å›¾ç‰‡ä¸Šä¼ ç›¸å…³äº‹ä»¶
        document.getElementById('imageUploadArea').addEventListener('click', () => document.getElementById('imageFile').click());
        document.getElementById('imageFile').addEventListener('change', handleImageUpload);
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        setupModalCloseEvents();
        
        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­æ›´å¤šèœå•
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.more-actions')) {
                closeAllMoreMenus();
            }
        });
        
        // ç›‘å¬å­˜å‚¨å˜åŒ–ï¼ˆç”¨äºè·¨æ ‡ç­¾é¡µåŒæ­¥ï¼‰
        window.addEventListener('storage', (e) => {
            if (e.key === 'wechatQuickReplies' || e.key === 'wechatFolders') {
                location.reload();
            }
        });
        
        // å®šæœŸæ£€æŸ¥è‡ªåŠ¨å¤‡ä»½
        setInterval(() => {
            if (autoBackupEnabled) {
                checkAutoBackup();
            }
        }, 60000); // æ¯60ç§’æ£€æŸ¥ä¸€æ¬¡
    }
    
    // è®¾ç½®æ¨¡æ€æ¡†å…³é—­äº‹ä»¶
    function setupModalCloseEvents() {
        const modals = [blockModal, imageModal, shareModal, exportModal, importModal, folderModal, moveToFolderModal, syncModal];
        modals.forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });
    }
    
    // å¾®ä¿¡åŒæ­¥ç›¸å…³åŠŸèƒ½
    function updateSyncStatusDisplay() {
        const statusInfo = document.getElementById('syncStatusInfo');
        if (autoBackupEnabled) {
            const lastBackup = localStorage.getItem('lastBackupTime');
            statusInfo.innerHTML = `è‡ªåŠ¨å¤‡ä»½å·²å¼€å¯<br>æœ€åå¤‡ä»½: ${lastBackup || 'ä»æœªå¤‡ä»½'}`;
            statusInfo.style.color = '#07C160';
        } else {
            statusInfo.innerHTML = 'è‡ªåŠ¨å¤‡ä»½æœªå¼€å¯<br>ç‚¹å‡»"å¼€å¯è‡ªåŠ¨å¤‡ä»½"æ¥å¯ç”¨';
            statusInfo.style.color = '#666';
        }
    }
    
    function toggleAutoBackup() {
        autoBackupEnabled = !autoBackupEnabled;
        localStorage.setItem('autoBackupEnabled', autoBackupEnabled);
        
        if (autoBackupEnabled) {
            showSyncStatus('è‡ªåŠ¨å¤‡ä»½å·²å¼€å¯', 'success');
            // ç«‹å³æ‰§è¡Œä¸€æ¬¡å¤‡ä»½
            createAutoBackup();
        } else {
            showSyncStatus('è‡ªåŠ¨å¤‡ä»½å·²å…³é—­', 'error');
        }
        
        updateSyncStatusDisplay();
    }
    
    function checkAutoBackup() {
        const lastBackup = localStorage.getItem('lastBackupTime');
        const now = new Date().getTime();
        
        // å¦‚æœè¶…è¿‡1å°æ—¶æ²¡æœ‰å¤‡ä»½ï¼Œæˆ–è€…ä»æœªå¤‡ä»½è¿‡ï¼Œåˆ™æ‰§è¡Œå¤‡ä»½
        if (!lastBackup || (now - parseInt(lastBackup)) > 3600000) {
            createAutoBackup();
        }
    }
    
    function createAutoBackup() {
        if (!autoBackupEnabled) return;
        
        try {
            const backupData = {
                folders: folders,
                blocks: textBlocks.filter(block => block.type === 'text'), // åªå¤‡ä»½æ–‡æœ¬å†…å®¹
                backupTime: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // åœ¨å¾®ä¿¡ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æç¤ºç”¨æˆ·æ‰‹åŠ¨ä¿å­˜
            if (navigator.userAgent.match(/MicroMessenger/i)) {
                // å¾®ä¿¡ç¯å¢ƒä¸­ï¼Œæç¤ºç”¨æˆ·æ‰‹åŠ¨ä¿å­˜
                showSyncStatus('è¯·æ‰‹åŠ¨ä¿å­˜å¤‡ä»½æ–‡ä»¶', 'syncing');
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const a = document.createElement('a');
                a.href = url;
                a.download = BACKUP_FILE_NAME;
                a.click();
                
                // æ¸…ç†URL
                setTimeout(() => URL.revokeObjectURL(url), 1000);
            } else {
                // éå¾®ä¿¡ç¯å¢ƒï¼Œå¯ä»¥å°è¯•è‡ªåŠ¨ä¸‹è½½
                const a = document.createElement('a');
                a.href = url;
                a.download = BACKUP_FILE_NAME;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
            
            // æ›´æ–°å¤‡ä»½æ—¶é—´
            localStorage.setItem('lastBackupTime', new Date().getTime().toString());
            updateSyncStatusDisplay();
            showSyncStatus('è‡ªåŠ¨å¤‡ä»½å®Œæˆ', 'success');
            
        } catch (error) {
            console.error('è‡ªåŠ¨å¤‡ä»½å¤±è´¥:', error);
            showSyncStatus('è‡ªåŠ¨å¤‡ä»½å¤±è´¥', 'error');
        }
    }
    
    function createManualBackup() {
        try {
            const backupData = {
                folders: folders,
                blocks: textBlocks.filter(block => block.type === 'text'),
                backupTime: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // åˆ›å»ºä¸‹è½½é“¾æ¥
            const a = document.createElement('a');
            a.href = url;
            a.download = BACKUP_FILE_NAME;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // æ¸…ç†URL
            setTimeout(() => URL.revokeObjectURL(url), 1000);
            
            // æ›´æ–°å¤‡ä»½æ—¶é—´
            localStorage.setItem('lastBackupTime', new Date().getTime().toString());
            updateSyncStatusDisplay();
            showSyncStatus('æ‰‹åŠ¨å¤‡ä»½å®Œæˆ', 'success');
            
        } catch (error) {
            console.error('æ‰‹åŠ¨å¤‡ä»½å¤±è´¥:', error);
            showSyncStatus('æ‰‹åŠ¨å¤‡ä»½å¤±è´¥', 'error');
        }
    }
    
    function restoreFromBackup() {
        // åˆ›å»ºæ–‡ä»¶è¾“å…¥å…ƒç´ 
        const fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.accept = '.json';
        fileInput.style.display = 'none';
        
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    if (backupData.blocks && Array.isArray(backupData.blocks)) {
                        // ç¡®è®¤æ¢å¤
                        if (confirm('ç¡®å®šè¦ä»å¤‡ä»½æ¢å¤æ•°æ®å—ï¼Ÿå½“å‰æ•°æ®å°†è¢«è¦†ç›–ã€‚')) {
                            // æ¢å¤æ•°æ®
                            textBlocks = backupData.blocks;
                            if (backupData.folders && Array.isArray(backupData.folders)) {
                                folders = backupData.folders;
                            }
                            
                            saveToLocalStorage();
                            saveFoldersToLocalStorage();
                            renderFolders();
                            renderBlocks();
                            updateFolderSelects();
                            
                            showSyncStatus('æ•°æ®æ¢å¤æˆåŠŸ', 'success');
                            closeSyncModal();
                        }
                    } else {
                        alert('å¤‡ä»½æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®');
                    }
                } catch (error) {
                    alert('æ¢å¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼');
                }
            };
            
            reader.readAsText(file);
        });
        
        document.body.appendChild(fileInput);
        fileInput.click();
        document.body.removeChild(fileInput);
    }
    
    function showSyncStatus(message, type) {
        syncStatus.style.display = 'flex';
        syncStatus.className = `sync-status ${type}`;
        syncStatus.querySelector('.sync-text').textContent = message;
        
        if (type !== 'syncing') {
            setTimeout(() => {
                syncStatus.style.display = 'none';
            }, 3000);
        }
    }
    
    function openSyncModal() {
        document.getElementById('syncModal').style.display = 'flex';
    }
    
    function closeSyncModal() {
        document.getElementById('syncModal').style.display = 'none';
    }
    
    // ä¿®æ”¹ä¿å­˜å‡½æ•°ï¼Œåœ¨æ•°æ®å˜æ›´æ—¶æ£€æŸ¥è‡ªåŠ¨å¤‡ä»½
    function saveToLocalStorage() {
        localStorage.setItem('wechatQuickReplies', JSON.stringify(textBlocks));
        // æ•°æ®å˜æ›´æ—¶æ£€æŸ¥è‡ªåŠ¨å¤‡ä»½
        if (autoBackupEnabled) {
            checkAutoBackup();
        }
    }
    
    function saveFoldersToLocalStorage() {
        localStorage.setItem('wechatFolders', JSON.stringify(folders));
        // æ•°æ®å˜æ›´æ—¶æ£€æŸ¥è‡ªåŠ¨å¤‡ä»½
        if (autoBackupEnabled) {
            checkAutoBackup();
        }
    }
    
    // æ¸²æŸ“æ–‡ä»¶å¤¹
    function renderFolders() {
        const foldersHTML = folders.map(folder => {
            const blockCount = textBlocks.filter(block => block.folder === folder.id).length;
            return `
                <div class="folder" data-folder="${folder.id}">
                    <div class="folder-name">${folder.name}</div>
                    <div class="folder-count">${blockCount}</div>
                    ${folder.id !== 'default' ? `
                        <div class="folder-actions">
                            <button class="folder-action-btn edit" data-folder="${folder.id}">ç¼–è¾‘</button>
                            <button class="folder-action-btn delete" data-folder="${folder.id}">åˆ é™¤</button>
                        </div>
                    ` : ''}
                </div>
            `;
        }).join('');
        
        foldersContainer.innerHTML = `
            <div class="folder active" data-folder="all">
                <div class="folder-name">å…¨éƒ¨</div>
                <div class="folder-count">${textBlocks.length}</div>
            </div>
            ${foldersHTML}
            <div class="add-folder-btn" id="addFolderBtn">
                <div>+</div>
                <div>æ–°å»ºæ–‡ä»¶å¤¹</div>
            </div>
        `;
        
        // é‡æ–°ç»‘å®šæ‰€æœ‰æ–‡ä»¶å¤¹ç›¸å…³äº‹ä»¶
        bindFolderEvents();
    }
    
    // æ–°å¢å‡½æ•°ï¼šç»‘å®šæ–‡ä»¶å¤¹ç›¸å…³äº‹ä»¶
    function bindFolderEvents() {
        // æ·»åŠ æ–‡ä»¶å¤¹ç‚¹å‡»äº‹ä»¶
        foldersContainer.querySelectorAll('.folder').forEach(folder => {
            folder.addEventListener('click', (e) => {
                if (!e.target.classList.contains('folder-action-btn')) {
                    setActiveFolder(folder.dataset.folder);
                }
            });
        });
        
        // æ·»åŠ æ–‡ä»¶å¤¹æ“ä½œäº‹ä»¶
        foldersContainer.querySelectorAll('.folder-action-btn.edit').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                editFolder(btn.dataset.folder);
            });
        });
        
        foldersContainer.querySelectorAll('.folder-action-btn.delete').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteFolder(btn.dataset.folder);
            });
        });
        
        // é‡æ–°ç»‘å®šæ–°å»ºæ–‡ä»¶å¤¹æŒ‰é’®äº‹ä»¶
        document.getElementById('addFolderBtn').addEventListener('click', () => openFolderModal());
    }
    
    // è®¾ç½®æ´»åŠ¨æ–‡ä»¶å¤¹
    function setActiveFolder(folderId) {
        foldersContainer.querySelectorAll('.folder').forEach(folder => {
            folder.classList.remove('active');
        });
        foldersContainer.querySelector(`[data-folder="${folderId}"]`).classList.add('active');
        renderBlocks();
    }
    
    // è·å–å½“å‰æ´»åŠ¨æ–‡ä»¶å¤¹
    function getActiveFolder() {
        const activeFolder = foldersContainer.querySelector('.folder.active');
        return activeFolder ? activeFolder.dataset.folder : 'all';
    }
    
    // æ›´æ–°æ–‡ä»¶å¤¹é€‰æ‹©å™¨
    function updateFolderSelects() {
        const folderOptions = folders.map(folder => 
            `<option value="${folder.id}">${folder.name}</option>`
        ).join('');
        
        document.getElementById('blockFolder').innerHTML = folderOptions;
        document.getElementById('imageFolder').innerHTML = folderOptions;
        document.getElementById('targetFolder').innerHTML = folderOptions;
    }
    
    // æ‰“å¼€æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
    function openFolderModal(folderId = null) {
        const modal = document.getElementById('folderModal');
        const title = document.getElementById('folderModalTitle');
        const nameInput = document.getElementById('folderName');
        
        if (folderId) {
            // ç¼–è¾‘æ¨¡å¼
            const folder = folders.find(f => f.id === folderId);
            title.textContent = 'ç¼–è¾‘æ–‡ä»¶å¤¹';
            nameInput.value = folder.name;
            editingFolderId = folderId;
        } else {
            // æ–°å»ºæ¨¡å¼
            title.textContent = 'æ–°å»ºæ–‡ä»¶å¤¹';
            nameInput.value = '';
            editingFolderId = null;
        }
        
        modal.style.display = 'flex';
        nameInput.focus();
    }
    
    // å…³é—­æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
    function closeFolderModal() {
        document.getElementById('folderModal').style.display = 'none';
        editingFolderId = null;
    }
    
    // ä¿å­˜æ–‡ä»¶å¤¹
    function saveFolder() {
        const name = document.getElementById('folderName').value.trim();
        if (!name) {
            alert('è¯·è¾“å…¥æ–‡ä»¶å¤¹åç§°');
            return;
        }
        
        if (editingFolderId) {
            // ç¼–è¾‘ç°æœ‰æ–‡ä»¶å¤¹
            const folder = folders.find(f => f.id === editingFolderId);
            if (folder) {
                folder.name = name;
            }
        } else {
            // åˆ›å»ºæ–°æ–‡ä»¶å¤¹
            const newFolder = {
                id: 'folder_' + Date.now(),
                name: name
            };
            folders.push(newFolder);
        }
        
        saveFoldersToLocalStorage();
        renderFolders();
        updateFolderSelects();
        closeFolderModal();
        
        showSyncStatus(editingFolderId ? 'æ–‡ä»¶å¤¹å·²æ›´æ–°' : 'æ–‡ä»¶å¤¹å·²åˆ›å»º', 'success');
    }
    
    // ç¼–è¾‘æ–‡ä»¶å¤¹
    function editFolder(folderId) {
        openFolderModal(folderId);
    }
    
    // åˆ é™¤æ–‡ä»¶å¤¹
    function deleteFolder(folderId) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å¤¹å—ï¼Ÿæ–‡ä»¶å¤¹å†…çš„å†…å®¹å°†ç§»åŠ¨åˆ°é»˜è®¤æ–‡ä»¶å¤¹ã€‚')) {
            // å°†æ–‡ä»¶å¤¹å†…çš„å†…å®¹ç§»åŠ¨åˆ°é»˜è®¤æ–‡ä»¶å¤¹
            textBlocks.forEach(block => {
                if (block.folder === folderId) {
                    block.folder = 'default';
                }
            });
            
            // åˆ é™¤æ–‡ä»¶å¤¹
            folders = folders.filter(f => f.id !== folderId);
            
            saveToLocalStorage();
            saveFoldersToLocalStorage();
            renderFolders();
            renderBlocks();
            updateFolderSelects();
            
            showSyncStatus('æ–‡ä»¶å¤¹å·²åˆ é™¤', 'success');
        }
    }
    
    // æ‰“å¼€ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
    function openMoveToFolderModal(blockIndex) {
        movingBlockIndex = blockIndex;
        document.getElementById('moveToFolderModal').style.display = 'flex';
    }
    
    // å…³é—­ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹æ¨¡æ€æ¡†
    function closeMoveToFolderModal() {
        document.getElementById('moveToFolderModal').style.display = 'none';
        movingBlockIndex = -1;
    }
    
    // ç¡®è®¤ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹
    function confirmMoveToFolder() {
        if (movingBlockIndex === -1) return;
        
        const targetFolder = document.getElementById('targetFolder').value;
        textBlocks[movingBlockIndex].folder = targetFolder;
        
        saveToLocalStorage();
        renderBlocks();
        renderFolders();
        closeMoveToFolderModal();
        
        showSyncStatus('å·²ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹', 'success');
    }
    
    // æ‰“å¼€æ–‡æœ¬æ¨¡æ€æ¡†
    function openModal(index = -1) {
        editingIndex = index;
        
        if (index === -1) {
            document.getElementById('modalTitle').textContent = 'æ–°å»ºè¯æœ¯';
            document.getElementById('blockTitle').value = '';
            document.getElementById('blockContent').value = '';
        } else {
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘è¯æœ¯';
            document.getElementById('blockTitle').value = textBlocks[index].title;
            document.getElementById('blockContent').value = textBlocks[index].content;
        }
        
        blockModal.style.display = 'flex';
        document.getElementById('blockTitle').focus();
    }
    
    // å…³é—­æ–‡æœ¬æ¨¡æ€æ¡†
    function closeModal() {
        blockModal.style.display = 'none';
    }
    
    // æ‰“å¼€å›¾ç‰‡æ¨¡æ€æ¡†
    function openImageModal(index = -1) {
        editingIndex = index;
        currentImageData = null;
        
        if (index === -1) {
            document.getElementById('imageTitle').value = '';
            document.getElementById('imagePreviewContainer').style.display = 'none';
            document.getElementById('imageFile').value = '';
        } else {
            document.getElementById('imageTitle').value = textBlocks[index].title;
            document.getElementById('imagePreview').src = textBlocks[index].content;
            document.getElementById('imagePreviewContainer').style.display = 'block';
            currentImageData = textBlocks[index].content;
        }
        
        imageModal.style.display = 'flex';
        document.getElementById('imageTitle').focus();
    }
    
    // å…³é—­å›¾ç‰‡æ¨¡æ€æ¡†
    function closeImageModal() {
        imageModal.style.display = 'none';
        currentImageData = null;
    }
    
    // æ‰“å¼€åˆ†äº«æ¨¡æ€æ¡†
    function openShareModal(imageData) {
        document.getElementById('shareImagePreview').src = imageData;
        shareModal.style.display = 'flex';
    }
    
    // å…³é—­åˆ†äº«æ¨¡æ€æ¡†
    function closeShareModal() {
        shareModal.style.display = 'none';
    }
    
    // æ‰“å¼€å¯¼å…¥æ¨¡æ€æ¡†
    function openImportModal() {
        document.getElementById('importData').value = '';
        importModal.style.display = 'flex';
    }
    
    // å…³é—­å¯¼å…¥æ¨¡æ€æ¡†
    function closeImportModal() {
        importModal.style.display = 'none';
    }
    
    // æ‰“å¼€å¯¼å‡ºæ¨¡æ€æ¡†
    function openExportModal() {
        if (textBlocks.length === 0) {
            alert('æ²¡æœ‰å†…å®¹å¯ä»¥å¯¼å‡º');
            return;
        }
        
        // ç­›é€‰æ‰å›¾ç‰‡æ•°æ®ï¼Œåªå¯¼å‡ºæ–‡æœ¬å†…å®¹
        const textOnlyBlocks = textBlocks.filter(block => block.type === 'text');
        
        if (textOnlyBlocks.length === 0) {
            alert('æ²¡æœ‰æ–‡æœ¬å†…å®¹å¯ä»¥å¯¼å‡º');
            return;
        }
        
        const exportData = JSON.stringify({
            folders: folders,
            blocks: textOnlyBlocks  // åªå¯¼å‡ºæ–‡æœ¬å—
        }, null, 2);
        
        document.getElementById('exportData').value = exportData;
        exportModal.style.display = 'flex';
    }
    
    // å…³é—­å¯¼å‡ºæ¨¡æ€æ¡†
    function closeExportModal() {
        exportModal.style.display = 'none';
    }
    
    // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
    function handleImageUpload() {
        const file = document.getElementById('imageFile').files[0];
        if (!file) return;
        
        if (!file.type.startsWith('image/')) {
            alert('è¯·é€‰æ‹©å›¾ç‰‡æ–‡ä»¶ï¼');
            return;
        }
        
        if (file.size > 5 * 1024 * 1024) {
            alert('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5MBï¼');
            return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
            currentImageData = e.target.result;
            document.getElementById('imagePreview').src = currentImageData;
            document.getElementById('imagePreviewContainer').style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
    
    // ä¿å­˜æ–‡æœ¬å—
    function saveBlock() {
        const title = document.getElementById('blockTitle').value.trim();
        const content = document.getElementById('blockContent').value.trim();
        const folder = document.getElementById('blockFolder').value;
        
        if (!title) {
            alert('è¯·è¾“å…¥è¯æœ¯æ ‡é¢˜');
            return;
        }
        
        if (!content) {
            alert('è¯·è¾“å…¥å›å¤å†…å®¹');
            return;
        }
        
        if (editingIndex === -1) {
            textBlocks.push({
                title,
                content,
                type: 'text',
                folder: folder,
                createdAt: new Date().toISOString(),
                collapsed: false
            });
        } else {
            textBlocks[editingIndex] = {
                ...textBlocks[editingIndex],
                title,
                content,
                folder: folder
            };
        }
        
        saveToLocalStorage();
        renderBlocks();
        renderFolders();
        closeModal();
        
        showSyncStatus(editingIndex === -1 ? 'è¯æœ¯å·²åˆ›å»º' : 'è¯æœ¯å·²æ›´æ–°', 'success');
    }
    
    // ä¿å­˜å›¾ç‰‡
    function saveImage() {
        const title = document.getElementById('imageTitle').value.trim();
        const folder = document.getElementById('imageFolder').value;
        
        if (!title) {
            alert('è¯·è¾“å…¥å›¾ç‰‡æ ‡é¢˜');
            return;
        }
        
        if (!currentImageData) {
            alert('è¯·é€‰æ‹©å›¾ç‰‡');
            return;
        }
        
        if (editingIndex === -1) {
            textBlocks.push({
                title,
                content: currentImageData,
                type: 'image',
                folder: folder,
                createdAt: new Date().toISOString(),
                collapsed: false
            });
        } else {
            textBlocks[editingIndex] = {
                ...textBlocks[editingIndex],
                title,
                content: currentImageData,
                type: 'image',
                folder: folder
            };
        }
        
        saveToLocalStorage();
        renderBlocks();
        renderFolders();
        closeImageModal();
        
        showSyncStatus(editingIndex === -1 ? 'å›¾ç‰‡å·²æ·»åŠ ' : 'å›¾ç‰‡å·²æ›´æ–°', 'success');
    }
    
    // åˆ é™¤æ–‡æœ¬å—
    function deleteBlock(index) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå†…å®¹å—ï¼Ÿ')) {
            textBlocks.splice(index, 1);
            saveToLocalStorage();
            renderBlocks();
            renderFolders();
            
            showSyncStatus('å†…å®¹å·²åˆ é™¤', 'success');
        }
    }
    
    // å¤åˆ¶æ–‡æœ¬å†…å®¹
    function copyTextContent(index) {
        const block = textBlocks[index];
        const textToCopy = block.content;
        
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        textarea.style.position = 'fixed';
        textarea.style.opacity = '0';
        document.body.appendChild(textarea);
        textarea.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showCopySuccess();
            }
        } catch (err) {
            console.error('å¤åˆ¶å¤±è´¥: ', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·é•¿æŒ‰é€‰æ‹©å¤åˆ¶');
        }
        
        document.body.removeChild(textarea);
    }
    
    // åˆ†äº«å›¾ç‰‡
    function shareImageContent(index) {
        const block = textBlocks[index];
        openShareModal(block.content);
    }
    
    // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤º
    function showCopySuccess() {
        const copySuccess = document.getElementById('copySuccess');
        copySuccess.style.display = 'block';
        setTimeout(() => {
            copySuccess.style.display = 'none';
        }, 1500);
    }
    
    // åˆ‡æ¢æŠ˜å çŠ¶æ€
    function toggleCollapse(index) {
        textBlocks[index].collapsed = !textBlocks[index].collapsed;
        saveToLocalStorage();
        renderBlocks();
    }
    
    // ä¸Šç§»æ–‡æœ¬å—
    function moveUp(index) {
        if (index === 0) return;
        
        const blockToMove = textBlocks.splice(index, 1)[0];
        textBlocks.splice(index - 1, 0, blockToMove);
        
        saveToLocalStorage();
        renderBlocks();
    }
    
    // ä¸‹ç§»æ–‡æœ¬å—
    function moveDown(index) {
        if (index === textBlocks.length - 1) return;
        
        const blockToMove = textBlocks.splice(index, 1)[0];
        textBlocks.splice(index + 1, 0, blockToMove);
        
        saveToLocalStorage();
        renderBlocks();
    }
    
    // ç½®é¡¶æ–‡æœ¬å—
    function moveToTop(index) {
        if (index === 0) return;
        
        const blockToMove = textBlocks.splice(index, 1)[0];
        textBlocks.unshift(blockToMove);
        
        saveToLocalStorage();
        renderBlocks();
    }
    
    // å…³é—­æ‰€æœ‰æ›´å¤šèœå•
    function closeAllMoreMenus() {
        document.querySelectorAll('.more-menu').forEach(menu => {
            menu.style.display = 'none';
        });
    }
    
    // æ¸²æŸ“æ–‡æœ¬å—
    function renderBlocks() {
        const searchTerm = searchInput.value.toLowerCase();
        const activeFolder = getActiveFolder();
        
        const filteredBlocks = textBlocks.filter(block => {
            const matchesSearch = block.title.toLowerCase().includes(searchTerm);
            const matchesFolder = activeFolder === 'all' || block.folder === activeFolder;
            return matchesSearch && matchesFolder;
        });
        
        blocksContainer.innerHTML = '';
        
        if (filteredBlocks.length === 0) {
            if (textBlocks.length === 0) {
                blocksContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>è¿˜æ²¡æœ‰å¿«æ·å›å¤å†…å®¹</h3>
                        <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹åˆ›å»º</p>
                    </div>
                `;
            } else {
                blocksContainer.innerHTML = `
                    <div class="empty-state">
                        <h3>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„å†…å®¹</h3>
                        <p>å°è¯•ä½¿ç”¨ä¸åŒçš„æœç´¢è¯æˆ–åˆ‡æ¢æ–‡ä»¶å¤¹</p>
                    </div>
                `;
            }
            return;
        }
        
        filteredBlocks.forEach((block, index) => {
            const originalIndex = textBlocks.findIndex(b => b === block);
            const blockElement = document.createElement('div');
            blockElement.className = `text-block ${block.collapsed ? 'collapsed' : ''} ${block.type === 'image' ? 'image-block' : ''}`;
            
            const typeIndicator = block.type === 'image' ? '<span class="image-block-indicator">å›¾ç‰‡</span>' : '';
            
            blockElement.innerHTML = `
                <div class="text-block-header">
                    <div class="text-block-title">
                        <span class="collapse-icon">â–¼</span>
                        ${block.title}
                        ${typeIndicator}
                    </div>
                    <div class="text-block-actions">
                        <button class="action-icon copy" title="å¤åˆ¶">ğŸ“‹</button>
                        <button class="action-icon edit" title="ç¼–è¾‘">âœï¸</button>
                        <div class="more-actions">
                            <button class="action-icon more" title="æ›´å¤šæ“ä½œ">â‹¯</button>
                            <div class="more-menu">
                                <button class="move-top-action">
                                    <span class="menu-icon">â¬†ï¸</span>
                                    <span>ç½®é¡¶</span>
                                </button>
                                <button class="move-up-action">
                                    <span class="menu-icon">â†‘</span>
                                    <span>ä¸Šç§»</span>
                                </button>
                                <button class="move-down-action">
                                    <span class="menu-icon">â†“</span>
                                    <span>ä¸‹ç§»</span>
                                </button>
                                <button class="move-folder-action">
                                    <span class="menu-icon">ğŸ“</span>
                                    <span>ç§»åŠ¨åˆ°æ–‡ä»¶å¤¹</span>
                                </button>
                                <button class="delete-action">
                                    <span class="menu-icon">ğŸ—‘ï¸</span>
                                    <span>åˆ é™¤</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-block-content">
                    ${block.type === 'image' ? 
                        `<img src="${block.content}" class="image-preview" alt="${block.title}">
                         <div class="image-actions">
                             <button class="share-image-btn">è½¬å‘å›¾ç‰‡</button>
                         </div>` : 
                        block.content.replace(/\n/g, '<br>')}
                </div>
                ${block.type === 'text' ? `<div class="text-block-footer">
                    <button class="copy-content-btn">å¤åˆ¶å†…å®¹</button>
                </div>` : ''}
            `;
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const header = blockElement.querySelector('.text-block-header');
            const copyBtn = blockElement.querySelector('.action-icon.copy');
            const editBtn = blockElement.querySelector('.action-icon.edit');
            const moreBtn = blockElement.querySelector('.action-icon.more');
            const moreMenu = blockElement.querySelector('.more-menu');
            const moveTopBtn = blockElement.querySelector('.move-top-action');
            const moveUpBtn = blockElement.querySelector('.move-up-action');
            const moveDownBtn = blockElement.querySelector('.move-down-action');
            const moveFolderBtn = blockElement.querySelector('.move-folder-action');
            const deleteBtn = blockElement.querySelector('.delete-action');
            const copyContentBtn = blockElement.querySelector('.copy-content-btn');
            const shareImageBtn = blockElement.querySelector('.share-image-btn');
            
            // ç‚¹å‡»æ ‡é¢˜åˆ‡æ¢æŠ˜å çŠ¶æ€
            header.addEventListener('click', (e) => {
                if (!e.target.closest('.text-block-actions')) {
                    toggleCollapse(originalIndex);
                }
            });
            
            copyBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (block.type === 'image') {
                    shareImageContent(originalIndex);
                } else {
                    copyTextContent(originalIndex);
                }
            });
            
            editBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (block.type === 'image') {
                    openImageModal(originalIndex);
                } else {
                    openModal(originalIndex);
                }
            });
            
            // æ›´å¤šèœå•
            moreBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.more-menu').forEach(menu => {
                    if (menu !== moreMenu) {
                        menu.style.display = 'none';
                    }
                });
                moreMenu.style.display = moreMenu.style.display === 'block' ? 'none' : 'block';
                
                // å®šä½èœå•
                const rect = moreBtn.getBoundingClientRect();
                moreMenu.style.position = 'fixed';
                moreMenu.style.top = (rect.bottom + 5) + 'px';
                moreMenu.style.right = (window.innerWidth - rect.right) + 'px';
            });
            
            // èœå•ä¸­çš„æ“ä½œæŒ‰é’®
            moveTopBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                moreMenu.style.display = 'none';
                moveToTop(originalIndex);
            });
            
            moveUpBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                moreMenu.style.display = 'none';
                moveUp(originalIndex);
            });
            
            moveDownBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                moreMenu.style.display = 'none';
                moveDown(originalIndex);
            });
            
            moveFolderBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                moreMenu.style.display = 'none';
                openMoveToFolderModal(originalIndex);
            });
            
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                moreMenu.style.display = 'none';
                deleteBlock(originalIndex);
            });
            
            if (copyContentBtn) {
                copyContentBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    copyTextContent(originalIndex);
                });
            }
            
            if (shareImageBtn) {
                shareImageBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    shareImageContent(originalIndex);
                });
            }
            
            blocksContainer.appendChild(blockElement);
        });
    }
    
    // ç¡®è®¤å¯¼å…¥
    function confirmImport() {
        const importData = document.getElementById('importData').value.trim();
        if (!importData) {
            alert('è¯·è¾“å…¥è¦å¯¼å…¥çš„æ•°æ®');
            return;
        }
        
        try {
            const data = JSON.parse(importData);
            if (data.blocks && Array.isArray(data.blocks)) {
                // å¯¼å…¥æ—¶åªå¤„ç†æ–‡æœ¬å†…å®¹
                const importedTextBlocks = data.blocks.filter(block => block.type === 'text');
                
                if (importedTextBlocks.length === 0) {
                    alert('å¯¼å…¥çš„æ•°æ®ä¸­æ²¡æœ‰æ–‡æœ¬å†…å®¹');
                    return;
                }
                
                textBlocks = textBlocks.concat(importedTextBlocks);
                
                if (data.folders && Array.isArray(data.folders)) {
                    // åˆå¹¶æ–‡ä»¶å¤¹ï¼Œé¿å…é‡å¤
                    data.folders.forEach(newFolder => {
                        if (!folders.find(f => f.id === newFolder.id)) {
                            folders.push(newFolder);
                        }
                    });
                }
                
                saveToLocalStorage();
                saveFoldersToLocalStorage();
                renderFolders();
                renderBlocks();
                updateFolderSelects();
                alert(`æˆåŠŸå¯¼å…¥ ${importedTextBlocks.length} ä¸ªæ–‡æœ¬å†…å®¹`);
                closeImportModal();
            } else {
                alert('å¯¼å…¥æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
            }
        } catch (error) {
            alert('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼');
        }
    }
    
    // å¤åˆ¶å¯¼å‡ºæ•°æ®
    function copyExportData() {
        const exportData = document.getElementById('exportData');
        exportData.select();
        
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showCopySuccess();
            } else {
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
            }
        } catch (err) {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©å¤åˆ¶');
        }
    }
    
    // åˆå§‹åŒ–åº”ç”¨
    init();
</script>
</body>
</html>